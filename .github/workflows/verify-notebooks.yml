name: Verify Notebooks

on:
  push:
    branches:
      - master
    paths:
      - ".github/workflows/verify-notebooks.yml"
      - "examples/model-deployment/"
      - "commerce-product-ranking/notebooks"
  pull_request:
    branches:
      - master
    paths:
      - ".github/workflows/verify-notebooks.yml"
      - "examples/model-deployment/"
      - "commerce-product-ranking/notebooks"

defaults:
  run:
    # Specify to ensure "pipefail and errexit" are set.
    # Ref: https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#defaultsrunshell
    shell: bash

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          pip install --upgrade -qqq pytest notebook nbconvert runnb pandas torch numpy scikit-learn

      - name: Run ONNXModelExport
        working-directory: examples/model-deployment
        run: |
          runnb --allow-not-trusted ONNXModelExport.ipynb

      - name: Run commerce-product-ranking notebooks
        working-directory: commerce-product-ranking/notebooks
        run: |
          runnb --allow-not-trusted Train-lightgbm.ipynb
          runnb --allow-not-trusted Train-xgboost.ipynb
          runnb --allow-not-trusted train_neural.ipynb
