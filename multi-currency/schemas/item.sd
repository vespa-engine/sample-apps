schema item {
    document item {
        field item_name type string {
            indexing: index | summary
            match: text
            index: enable-bm25
        }
        field price type double {
            indexing: attribute | summary
            attribute: fast-search
            rank: filter
        }
        field price_usd type double {
            indexing: attribute | summary
            attribute: fast-search
            rank: filter
        }
        field currency_ref type reference<currency> {
            indexing: attribute | summary
            attribute: fast-search
            rank: filter
        }
    }
    import field currency_ref.factor as currency_factor {}

    fieldset default {
    	fields: item_name
    }

    rank-profile default {
        function price_usd() {
            expression: attribute(price) * attribute(currency_factor)
        }
        first-phase {
            expression: bm25(item_name) * log(price_usd)
        }
        summary-features {
            attribute(price)
            price_usd
            bm25(item_name)
        }
    }

    document-summary default {
        summary item_name {}
        summary currency_factor {}
    }
}