# Copyright Vespa.ai. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.

schema passage {

  document passage {

    field id type string {
       indexing: summary | attribute
    }
    field text type string {
      indexing: summary | index
      index: enable-bm25
    }
    
  }
  field embedding type tensor<bfloat16>(x[384]) {
            indexing: input text  | embed e5_small | attribute | index
            attribute {
              distance-metric: angular
            }
            index {
                    hnsw {
                          max-links-per-node: 32
                          neighbors-to-explore-at-insert: 100
                    }
    }

  }
  fieldset default {
    fields: text
  }

  rank-profile hybrid {
        inputs {
          query(e) tensor<bfloat16>(x[384])
        }
        first-phase {
            expression: 2 * closeness(field, embedding) + bm25(text) / 11 
        }
        match-features: bm25(text) closeness(field, embedding)
    }

}
