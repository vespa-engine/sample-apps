# Copyright Vespa.ai. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.

# See https://docs.vespa.ai/en/schemas.html
schema doc {

    document doc {

        field text type string {
            indexing: index | summary
            index: enable-bm25
        }
        field text_sidecar type string {
            indexing: index | summary
            index: enable-bm25
        }
    }
    fieldset default {
        fields: text
    }

    field embedding_sidecar type tensor<float>(x[768]) {
        indexing: input text_sidecar | embed myembedder | summary | attribute | index
        attribute {
            distance-metric: angular
        }
    }

    field embedding_inside type tensor<float>(x[768]) {
        indexing: input text | embed nomic_modernbert | summary | attribute | index
        attribute {
            distance-metric: angular
        }
    }

    # See https://docs.vespa.ai/en/ranking.html
    rank-profile inside inherits default {
        inputs {
            query(e) tensor<float>(x[768])
        }
        first-phase {
            expression: closeness(field, embedding_inside)
        }
        match-features: closeness(field, embedding_inside)
        
    }
    rank-profile sidecar inherits default {
        inputs {
            query(e) tensor<float>(x[768])
        }
        first-phase {
            expression: closeness(field, embedding_sidecar)
        }
        match-features: closeness(field, embedding_sidecar)
        
    }
    document-summary default {
        summary embedding_inside {}
        summary embedding_sidecar {}
        summary text {}
        summary text_sidecar {}
    }
   
}
